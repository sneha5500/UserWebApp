@model UserWebApp.Models.User

@{
    ViewData["Title"] = "Create";
}

<h1>Create</h1>

<h4>User Registration</h4>
<hr />
<div class="row">
    <div class="col-md-6">
        <form asp-action="Create" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <!-- Full Name -->
            <div class="form-group">
                <label asp-for="Name" class="control-label"></label>
                <input asp-for="Name" class="form-control" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>

            <!-- Gender Dropdown -->
            <div class="form-group">
                <label asp-for="Gender" class="control-label"></label>
                <select asp-for="Gender" class="form-control">
                    <option value="">-- Select Gender --</option>
                    <option>Male</option>
                    <option>Female</option>
                    <option>Other</option>
                </select>
                <span asp-validation-for="Gender" class="text-danger"></span>
            </div>

            <!-- Country Dropdown -->
            <div class="form-group">
                <label asp-for="Place" class="control-label"></label>
                <select asp-for="Place" asp-items="new SelectList(ViewBag.Countries)" class="form-control">
                    <option value="">-- Select Country --</option>
                </select>
                <span asp-validation-for="Place" class="text-danger"></span>
            </div>

            <!-- Email -->
            <div class="form-group">
                <label asp-for="Email" class="control-label"></label>
                <input asp-for="Email" class="form-control" />
                <span asp-validation-for="Email" class="text-danger"></span>
            </div>

            <!-- Phone -->
            <div class="form-group">
                <label asp-for="Phone" class="control-label"></label>
                <input asp-for="Phone" class="form-control" />
                <span asp-validation-for="Phone" class="text-danger"></span>
            </div>

            <!-- Date of Birth -->
            <div class="form-group">
                <label asp-for="DateOfBirth" class="control-label"></label>
                <input asp-for="DateOfBirth" type="date" class="form-control" />
                <span asp-validation-for="DateOfBirth" class="text-danger"></span>
            </div>

            <!-- Registered On -->
            <div class="form-group">
                <label asp-for="RegisteredOn" class="control-label"></label>
                <input asp-for="RegisteredOn" class="form-control" readonly />
            </div>

            <!-- Profile Picture -->
            <div class="form-group">
                <label>Upload Profile Picture</label>
                <input type="file" name="ProfilePicture" class="form-control" />
            </div>

            <!-- Map -->
            <div class="form-group">
                <label>Select Location on Map</label>
                <div id="map" style="height: 300px;"></div>
            </div>

            <!-- Hidden Latitude & Longitude -->
            <input type="hidden" id="Latitude" name="Latitude" />
            <input type="hidden" id="Longitude" name="Longitude" />

            <!-- Submit -->
            <div class="form-group mt-3">
                <input type="submit" value="Create" class="btn btn-primary" />
            </div>
        </form>
    </div>
</div>

<div>
    <a asp-action="Index">Back to List</a>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <!-- Leaflet CSS and JS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <script>
        var map = L.map('map').setView([17.385044, 78.486671], 5); // Start in Hyderabad

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        var marker;

        map.on('click', function (e) {
            var lat = e.latlng.lat.toFixed(6);
            var lng = e.latlng.lng.toFixed(6);

            document.getElementById("Latitude").value = lat;
            document.getElementById("Longitude").value = lng;

            if (marker) {
                marker.setLatLng(e.latlng);
            } else {
                marker = L.marker(e.latlng).addTo(map);
            }
        });
    </script>
}

